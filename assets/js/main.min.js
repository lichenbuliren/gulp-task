!function(e,t){var a={Cookie:{set:function(e,a,i){var n="";if(i){var r=new Date;r.setTime(r.getTime()+60*i*60*1e3),n="; expires="+r.toGMTString()}else n="";t.cookie=e+"="+a+n+"; domain=.meizu.com;path=/"},get:function(e){for(var a=e+"=",i=t.cookie.split(";"),n=0;n<i.length;n++){for(var r=i[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(a))return r.substring(a.length,r.length)}return null},remove:function(e){this.set(e,"",-1)}},isNullOrEmpty:function(e){return null==e||"undefined"==e?!0:/^\s*$/.test(e)},isEmptyObj:function(e){for(var t in e)return!1;return!0},getObjKeys:function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[t.length]=a);return t},combInArray:function(e){if(!e||!e.length)return[];for(var t=e.length,i=[],n=1;t>n;n++)for(var r=a.getCombFlags(t,n);r.length;){for(var d=r.shift(),o=[],s=0;t>s;s++)d[s]&&o.push(e[s]);i.push(o)}return i},getCombFlags:function(e,t){if(!t||1>t)return[];var a,i,n,r=[],d=[],o=!0;for(a=0;e>a;a++)d[a]=t>a?1:0;for(r.push(d.concat());o;)for(n=0,a=0;e-1>a;a++){if(1==d[a]&&0==d[a+1]){for(i=0;a>i;i++)d[i]=n>i?1:0;d[a]=0,d[a+1]=1;var s=d.concat();r.push(s),-1==s.slice(-t).join("").indexOf("0")&&(o=!1);break}1==d[a]&&n++}return r}};e.Util=a}(window,document),function(e,t){var a={version:"1.0.0",loginUrl:"test",checkLogin:function(){var a=t.Cookie.get("MEIZUSESSIONVAL");if(void 0==a||""==a)return!1;var i=e.parseJSON(a);return""!=a&&parseInt(i.uid)>0?!0:!1},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(t);return null!==a?unescape(a[2]):null},imgResize:function(t,a,i){var n,r,d,o,s=new Image,l=1;s.onload=function(){d=s.width,o=s.height,r=a/d,n=i/o,0==a&&0==i?l=1:0==a?1>n&&(l=n):0==i?1>r&&(l=r):(1>r||1>n)&&(l=n>=r?r:n),1>l&&(d*=l,o*=l),e(t).css({height:o+"px",width:d+"px",margin:"-"+o/2+"px 0 0 -"+d/2+"px"}).fadeIn(100)},s.src=t.src},compile:function(){return function(e,t){var a=new Function("data","var p=[];p.push('"+e.replace(/[\r\t\n]/gm," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');return p.join('');");return t?a(t):""}}(),render:function(a){var i="",n=a.containerId,r=a.templateId,d=a.beforeFn,o=a.afterFn,s=a.autoResize||"1",l=a.data||{},c=document.getElementById(n),u=document.getElementById(r).innerHTML;if(d&&d(l),!c)return console.error("模板容器不能为空，请检查containerId是否有效"),!1;if(!u)return console.error("模板内容为空，请检查templateId是否有效！"),!1;if(t.isEmptyObj(l))return console.log("数据为空，请重试！"),!1;if(i+=this.compile(u,l),c.innerHTML=i,"1"===s)for(var v=e("#"+n+" li.list-item img"),p=0,m=v.length;m>p;p++){var f=v[p],g=e(f).attr("width"),h=e(f).attr("height");this.imgResize(f,g,h),e(f).removeAttr("width").removeAttr("height")}o&&o(l)}};window.GLOBAL=a}(jQuery,Util),function(e,t,a){var i={},n={init:function(){t.checkLogin&&t.checkLogin()&&(window.location=t.loginUrl)},bindEvent:function(){e("body").on("click",".captcha",function(){var t=e(this).children("img"),a=t.attr("src");t.attr("src",a+"?"+(new Date).getTime())}),e('[name="mcodeid"]').focusout(function(t){var i=e(this).next(".tips");i.text(a.isNullOrEmpty(e(this).val())?"请输入M码":"")}),e('[name="captcha"]').focusout(function(t){var i=e(this).next(".tips");i.text(a.isNullOrEmpty(e(this).val())?"请输入验证码！":"")}),e('[rel="mcode"]').submit(function(){var t,i=e(this),r=i.data("api"),d=i.find('[name="mcodeid"]').val(),o=i.find('[name="captcha"]').val();return a.isNullOrEmpty(d)?(e('[name="mcodeid"]').next(".tips").text("请输入M码！"),!1):a.isNullOrEmpty(o)?(e('[name="captcha"]').next(".tips").text("请输入验证码！"),!1):(t=i.serialize(),e.ajax({type:"POST",url:r,data:t,dataType:"jsonp",jsonp:"callback",success:function(e){n.handlerResult(e)},error:function(t,a,i){return e("body").append(t.responseText).css("padding",10),alert("调用远程方法时出错！"),!1}}),!1)})},handlerResult:function(a){var r={status:200,error:"验证失败",mcode:{},data:{goods_list:[{gid:"1170010001",name:"MX4 Pro",img_url:"http://placehold.it/278x426",acid:1,key:"mx4-pro"},{gid:"1170010002",name:"魅蓝note",img_url:"http://placehold.it/278x426",acid:1,key:"m1-note"}],ext_list:[{eid:"1",gid:"1170010001",ext_name:"MX4 Pro联通灰色16G",market_price:"2399",price:"2199",vids:",5,13,18,",aids:",1,2,3,",av_data:[{aid:"1",aname:"颜色",vid:"5",value:"灰色"},{aid:"2",aname:"容量",vid:"13",value:"16G"},{aid:"3",aname:"网络制式",vid:"18",value:"联通"}]},{eid:"2",gid:"1170010001",ext_name:"MX4 Pro联通灰色32G",market_price:"2399",price:"2299",vids:",5,14,18,",aids:",1,2,3,",av_data:[{aid:"1",aname:"颜色",vid:"5",value:"灰色"},{aid:"2",aname:"容量",vid:"14",value:"32G"},{aid:"3",aname:"网络制式",vid:"18",value:"联通"}]},{eid:"3",gid:"1170010001",ext_name:"MX4 Pro联通白色16G",market_price:"2399",price:"2399",vids:",4,13,18,",aids:",1,2,3,",av_data:[{aid:"1",aname:"颜色",vid:"4",value:"白色"},{aid:"2",aname:"容量",vid:"13",value:"16G"},{aid:"3",aname:"网络制式",vid:"18",value:"联通"}]},{eid:"4",gid:"1170010001",ext_name:"MX4 Pro联通白色32G",market_price:"2399",price:"2499",vids:",4,14,18,",aids:",1,2,3,",av_data:[{aid:"1",aname:"颜色",vid:"4",value:"白色"},{aid:"2",aname:"容量",vid:"14",value:"32G"},{aid:"3",aname:"网络制式",vid:"18",value:"联通"}]},{eid:"5",gid:"1170010001",ext_name:"MX4 Pro电信白色32G",market_price:"2399",price:"2599",vids:",4,14,19,",aids:",1,2,3,",av_data:[{aid:"1",aname:"颜色",vid:"4",value:"白色"},{aid:"2",aname:"容量",vid:"14",value:"32G"},{aid:"3",aname:"网络制式",vid:"19",value:"电信"}]},{eid:"1170170001",gid:"1170010002",ext_name:"魅蓝note电信白色32G",market_price:"2399",price:"2199",vids:",4,14,19,",aids:",1,2,3,",av_data:[{aid:"1",aname:"颜色",vid:"4",value:"白色"},{aid:"2",aname:"容量",vid:"14",value:"32G"},{aid:"3",aname:"网络制式",vid:"19",value:"电信"}]},{eid:"1170170001",gid:"1170010002",ext_name:"魅蓝note电信灰色32G",market_price:"2399",price:"2199",vids:",5,14,19,",aids:",1,2,3,",av_data:[{aid:"1",aname:"颜色",vid:"5",value:"灰色"},{aid:"2",aname:"容量",vid:"14",value:"32G"},{aid:"3",aname:"网络制式",vid:"19",value:"电信"}]}]}};if(i=n.caulateGoodsInfo(r.data),200==r.status)t.render({containerId:"goods-list",templateId:"tpl-goods-list",data:i,afterFn:function(){e(".login-wrap").hide(),n.bindChooseEvent()}});else{if(10010!=r.status)return alert(r.error),!1;window.location=t.loginUrl}},bindChooseEvent:function(){function t(t,a,i){var n,r=t.find("."+a),d=[];return r.each(function(t,a){d.push(e(this).data("vid"))}),n=i?d.concat(i):d,n.sort(function(e,t){return parseInt(e)-parseInt(t)}),n}e("#goods-list").tab({item_active:"active",content_active:"active"}),e(".content").on("click",".property",function(){var n=e(this),r=n.parents(".content"),d=(r.data("gid"),n.closest(".container").find(".content").index(r)),o=i[d],s=o.data,l=a.getObjKeys(s),c=n.data("vid"),u=n.closest("dl").data("aid"),v=n.parents("dl").hasClass("disabled");v||n.addClass("selected").siblings(".property").removeClass("selected"),n.parents("dl").nextAll("dl").addClass("disabled").find(".property").removeClass("selected");var p=n.parents("dl").next("dl");if(p.length>0&&!v){p.removeClass("disabled");for(var m=n.parents("dl").prevAll("dl"),f=t(m,"selected",[c]),g={},h=0,x=l.length;x>h;h++){var y,b,_=l[h],L=_.split(","),w=f.join(",");_.indexOf(w)>0&&(y=L[u-2],b=o.attrList[u-1].extList[y],g[y]=b)}var O=(a.getObjKeys(g),"");for(vid in g)O+='<div class="property" data-vid="'+vid+'">'+g[vid]+"</div>";p.children("dd").empty().append(O)}var j=t(r,"selected");r.find(".price").text(j.length==o.aids.length?s[j.join(",")].price:"")});var n=e(".content dl").not(".disabled");n.on("mouseover mouseout",".property",function(t){"mouseover"==t.type?e(this).addClass("hover"):"mouseout"==t.type&&e(this).removeClass("hover")})},caulateGoodsInfo:function(e){var t=[],a=e.ext_list;t=e.goods_list;for(var i={},r=0,d=a.length;d>r;r++){{var o=a[r],s=o.gid,l=n.trimPrefixAndSuffix(o.aids,","),c=o.price,u=n.trimPrefixAndSuffix(o.vids,",");o.av_data}i[s]=i[s]||{},i[s].aids=i[s].aids||l.split(",").reverse(),i[s].data=i[s].data||{},i[s].data[u]={price:c};for(var v=0,p=o.av_data.length;p>v;v++){var m=o.av_data[v],f=m.aid,g=m.aname,h=m.vid,x=m.value;i[s].attrList=i[s].attrList||{},i[s].attrList[f]=i[s].attrList[f]||{},i[s].attrList[f].aid=f,i[s].attrList[f].aname=g,i[s].attrList[f].extList=i[s].attrList[f].extList||{},i[s].attrList[f].extList[h]=x}}for(var r=0,y=t.length;y>r;r++){var b=t[r],_=b.gid;t[r].attrList=i[_].attrList,t[r].aids=i[_].aids,t[r].data=i[_].data}return t},trimPrefixAndSuffix:function(e,t){return e.substring(e.indexOf(t)+1).substring(0,e.lastIndexOf(t)-1)}};e(document).ready(function(){n.init(),n.bindEvent()})}(jQuery,GLOBAL,Util);